# 悬赏任务:如何安全的在小蚁上用智能合约空投NEP5资产？
　　最近研究在小蚁上如何空投LRN(小蚁上的一种NEP5 token), 尝试了几种方式，比如:  
&emsp;&emsp;方法一：最直接的，用脚本调转账方法批量给用户打币;  
&emsp;&emsp;方法二：给每个用户生成一段鉴权合约，给这个合约打币，然后由用户自己提取（感谢NEL李剑英提供了这个方案）;  
&emsp;&emsp;方法三：写一个智能合约，用户触发这个合约的时候，可以提取特定数量的nep5资产到自己的账户；   
<br/></br>
&emsp;&emsp;虽然方法一和方法二从空投的角度都能实现空投这件事情，但我们对方法三的实现也是抱有极大的期待，为什么呢？是从Loopring协议最终在小蚁上落地考虑的。<br/></br>
&emsp;&emsp;Loopring协议在以太坊上通过智能合约已经得到很好的实现，而NEP5接口和ERC20接口是非常类似的，两者从功能定义上可以说是一致的，因此我们希望也通过智能合约在小蚁上落地Loopring协议，这个协议的落地是通过一些列合约的调用和配合完成的，其中有的合约会涉及到各种token资产的分配，这就和这里用智能合约空投NEP5资产有类似之处，为了后续协议能顺利落地，我们非常在意上边的方法三：**如何用在小蚁上使用智能合约，安全完成NEP5资产的空投**。  

&emsp;&emsp;再进一步举例说明我遇到的问题和挑战，[点击这里是一个用智能合约空投LRN的代码](https://github.com/Loopring/neo-protocol/blob/master/utils/LrnAirdropContract/LrnAirdropContract/LrnAirdropContract.cs)，功能上实现了以下几点：  
&emsp;&emsp;1、超级管理员可以给空投对象写入空投金额，比方给小明10个lrn，代表小明最多可以提取10个lrn;  
&emsp;&emsp;2、小明或任何人可以调用这个合约的withdraw方法，如果参数是小明的地址，而这个合约上lrn余额充足，假设这个合约地址上已经提前存入了200个lrn，那么合约会给小明提取10个以内的lrn;<br/></br>
&emsp;&emsp;这里有没有问题？<br/></br>
&emsp;&emsp;有的朋友可能已经发现，如果大家都是诚实守信的人，都是调用锁仓合约的withdraw方法，一切都是美好的，但是如果小明和任何人在通过这个合约的鉴权部分后，直接去调用lrn token的transfer方法，他是能够绕开withdraw方法里的限制，从而直接转走合约上的200个lrn，是不是这样？非常恐怖！

&emsp;&emsp;[这里是一段以太坊上实现ERC20资产空投的智能合约代码](https://github.com/Loopring/lrx-airdrop/blob/master/contracts/LrxAirdrop.sol)，非常期待您能给出功能等同的小蚁上的智能合约。  
<br/></br>
<br/></br>
# Rewarding Mission: How to airdrop NEP5 tokens with smart contract on NEO safaly?
&emsp;&emsp;Recently I'm working on how to airdrop LRN(a NEP5 token on NEO) on NEO. I have tried several ways, such as:  
&emsp;&emsp;Method 1: A direct and easy way, use a script to invoke the transfer method;  
&emsp;&emsp;Method 2: Generate an verification contract for each user, then deposit the LRN token on each verification contract, so the users could get the token  by themselves (thanks to Li Jianying who working on NEL for providing this solution);  
&emsp;&emsp;Method 3: Write a smart contract. When the user triggers the contract, it can transfer specific nep5 tokens to his/her own account;

&emsp;&emsp;Although the Method 1 and Method 2 above can attain the goal, we also have great expectations for the implementation of Method 3. Why? Because the Loopring protocol that eventually landed on NEO need use smart contracts.

&emsp;&emsp;The Loopring protocol has been well implemented in Ethereum through smart contracts. The NEP5 interface and the ERC20 interface are very similar. The two can be said to be consistent in terms of function definition. Therefore, we hope to use smart contracts to implement Loopring protocol on NEO. The implementation of the protocol is completed through the invocation and cooperation of a number of contracts, some of which will involve the distribution of various token assets, which is similar to the use of smart contract to airdrop nep5 assets here. In order to implement the Loopring protocol on NEO successfully, we are very concerned about the  method 3 above: **How to airdrop nep5 tokens with smart contracts on NEO safaly**?

&emsp;&emsp;To further illustrate the problems and challenges I encountered, [click here: a smart contract to drop LRN](https://github.com/Loopring/neo-protocol/blob/master/utils/LrnAirdropContract/LrnAirdropContract/LrnAirdropContract.cs), this smart contract implement the following points:  
&emsp;&emsp;1. The super administrator can write the amount of lrn for the target users by the depoist method, for example 10 lrn for Xiaoming;  
&emsp;&emsp;2. Xiaoming or anyone can call the withdraw method of this contract. If the parameter is the address of Xiao Ming, and the lrn balance on this contract is sufficient, assuming 200 lrns are already stored in advance on the contract address. The contract will invoke the transfer method of the lrn to give 10 lrn to Xiaoming.   

&emsp;&emsp;Is there any problem here?

&emsp;&emsp;Some friends may have discovered that if everyone is honest and trustworthy, they are all invoking with the withdraw method of the smart contract, everything is OK, but if Xiao Ming and anyone else go through the verification part of the contract, and the invoke the lrn token's transfer method, he is able to bypass the restrictions in the withdraw method, and get the all 200 lrn which is not belong to him! 

&emsp;&emsp;[Here is a airdrop smart contract on Ethereum](https://github.com/Loopring/lrx-airdrop/blob/master/contracts/LrxAirdrop.sol), we are looking forward to recieving a functionally equivalent smart contract on NEO.
