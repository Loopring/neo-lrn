# 空投领取

这里设定读者已经具备了NEO的基础知识，知道NEO地址的相关概念，知道如何访问NEO节点的RPC服务，可以参考[NEO官方教程](https://neo.org/dev)。这里也列出了一些[当前可以访问的NEO节点](http://monitor.cityofzion.io/)，大家可以选择有RPC端口开放的节点发起领取交易。
领取空投分为两步：
1. 查询可提取数量(查询这一步不是必须的，只是为了友好和清晰，显示当前可以领取的数量)；
2. 触发提取；

## 查询可提取数量
### 查询可提取数量Request
以地址Ad3aF5yDcYy5N42wbegJrdVfjQy4SfTKfK为例，小端scriptHash是e952c4dde16eb4d176ad9efcd8ef5896588b746f，关于NEO地址获取对应小端scriptHash可以使用这个[转换工具](https://peterlinx.github.io/DataTransformationTools/)。 
![image](https://github.com/LoopringSecondary/neo-protocol/blob/master/docs/addressConvert.jpeg)
查询当前可领取LRN空投数量，可以构造类似下面示例的请求，用待领取LRN的NEO地址的小端scriptHash替换下边脚本中的e952c4dde16eb4d176ad9efcd8ef5896588b746f即可。当返回值数量大于0，则说明可以提取。
```
{
  "jsonrpc": "2.0",
  "method": "invokescript",
  "params": ["14e952c4dde16eb4d176ad9efcd8ef5896588b746f51c1157175657279417661696c61626c6542616c616e636567f7c5643ab1896195b8abe8cfd2e3b450441ca45c",1],
  "id": 3
}
```
### 查询可提取数量Response
```
{
    "jsonrpc": "2.0",
    "id": 3,
    "result": {
        "script": "14e952c4dde16eb4d176ad9efcd8ef5896588b746f51c1157175657279417661696c61626c6542616c616e636567f7c5643ab1896195b8abe8cfd2e3b450441ca45c",
        "state": "HALT, BREAK",
        "gas_consumed": "1.211",
        "stack": [
            {
                "type": "Integer",
                "value": "1844115397260"
            }
        ]
    }
}
```
## 触发提取
[使用sendrawtransaction](https://docs.neo.org/docs/zh-cn/reference/rpc/latest-version/api/sendrawtransaction.html)  
这里给出一个[领取空投交易示例](https://neotracker.io/tx/de8b5e8dcd601ff3ec8ebb5c9835fb7ac002650db32601bb92d772f6088d4ee5)
其中的执行脚本是1c2018072413270000a60f148dd6df43259886e10e4fd26d896e2394eb51c108776974686472617767f7c5643ab1896195b8abe8cfd2e3b450441ca45c
这里替换执行脚本中的这段数据即可2018072413270000a60f148dd6df43259886e10e4fd26d896e2394eb，其中
2018072413270000是8byte的随机数(这个8byte数字每次领取时可以随机修改几位)，a60f148dd6df43259886e10e4fd26d896e2394eb是待提币地址的scriptHash.  
2019年小蚁主网变更了费用模型，体积超过1024字节的交易需要收取费用，所以为了减少交易体积，鉴权脚本不再传递，可以参考[一笔新交易](https://neotracker.io/tx/43b530e62377ad4c5b5b2b6468963582ccbbfa4b4cab239a09e1666a4dd98039)  
![image](https://github.com/LoopringSecondary/neo-protocol/blob/master/docs/sendrawtransaction.jpeg)

## 补充:查询账户空投总数

依然使用invokescript方法，执行脚本中有两个参数，一个是用户地址Hash，一个是参与的期数(我们一开始设计有三期空投)
下边这个示例中是地址2c3875e8cce9d78f5ab704388bf38d1c82dbbef1查询第一期(66697273745068617365)的空投总数
### Requset
```
{
  "jsonrpc": "2.0",
  "method": "invokescript",
  "params": ["0a66697273745068617365142c3875e8cce9d78f5ab704388bf38d1c82dbbef152c113717565727941697244726f7042616c616e636567f7c5643ab1896195b8abe8cfd2e3b450441ca45c"],
  "id": 1
}
```
如果是第二期脚本为：
```
0b7365636f6e645068617365142c3875e8cce9d78f5ab704388bf38d1c82dbbef152c113717565727941697244726f7042616c616e636567f7c5643ab1896195b8abe8cfd2e3b450441ca45c
```
第三期脚本为：
```
0a74686972645068617365142c3875e8cce9d78f5ab704388bf38d1c82dbbef152c113717565727941697244726f7042616c616e636567f7c5643ab1896195b8abe8cfd2e3b450441ca45c
```
只要替换每期脚本中的地址，则可以查到该地址每期空投能获得的总量。如果要求三期总数，需要查询三次求和。
### Response
```
{
    "jsonrpc": "2.0",
    "id": 1,
    "result": {
        "script": "0a66697273745068617365142c3875e8cce9d78f5ab704388bf38d1c82dbbef152c113717565727941697244726f7042616c616e636567f7c5643ab1896195b8abe8cfd2e3b450441ca45c",
        "state": "HALT, BREAK",
        "gas_consumed": "0.304",
        "stack": [
            {
                "type": "ByteArray",
                "value": "800305021b"
            }
        ]
    }
}
```
注意：这里的返回值是十六进制byte的数组，和前边查询可提取余额的接口不同，有点坑。
